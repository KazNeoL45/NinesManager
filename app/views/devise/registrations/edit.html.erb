<div class="max-w-6xl mx-auto space-y-8 animate-fade-in">

  <!-- HEADER -->
  <div class="bg-white rounded-3xl shadow-lg border border-gray-200 p-8 animate-slide-down">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-6">
        <div class="w-24 h-24 rounded-full flex items-center justify-center bg-gray-100 text-gray-900 text-3xl">
          <%= resource.name.split.map(&:first).join.upcase[0..1] %>
        </div>
        <div>
          <h1 class="text-3xl text-gray-900 mb-2"><%= resource.name %></h1>
          <div class="flex items-center space-x-3">
            <span class="px-3 py-1 bg-gray-200 text-gray-800 rounded-full text-sm capitalize">
              <%= resource.role %> account
            </span>
            <span class="text-sm text-gray-600"><%= resource.email %></span>
          </div>
        </div>
      </div>

      <%= link_to dashboard_path,
        class: "px-5 py-3 bg-black text-white rounded-xl hover:opacity-80 transition" do %>
        Back to dashboard
      <% end %>
    </div>
  </div>

  <!-- CARDS -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- PROFILE -->
    <div class="bg-white rounded-3xl shadow-lg border border-gray-200 p-6">
      <h2 class="text-xl text-gray-900 mb-4">Profile</h2>
      <p class="text-sm text-gray-600 mb-6">Name and role</p>
      <button type="button"
        onclick="openModal('profileModal')"
        class="w-full px-4 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">
        Edit profile
      </button>
    </div>

    <!-- EMAIL -->
    <div class="bg-white rounded-3xl shadow-lg border border-gray-200 p-6">
      <h2 class="text-xl text-gray-900 mb-4">Email</h2>
      <p class="text-sm text-gray-600 mb-6"><%= resource.email %></p>
      <button type="button"
        onclick="openModal('emailModal')"
        class="w-full px-4 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">
        Change email
      </button>
    </div>

    <!-- PASSWORD -->
    <div class="bg-white rounded-3xl shadow-lg border border-gray-200 p-6">
      <h2 class="text-xl text-gray-900 mb-4">Security</h2>
      <p class="text-sm text-gray-600 mb-6">Password & access</p>
      <button type="button"
        onclick="openModal('passwordModal')"
        class="w-full px-4 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">
        Change password
      </button>
    </div>
  </div>

  <!-- DANGER -->
  <div class="bg-white rounded-3xl shadow-lg border-2 border-red-300 p-6">
    <h2 class="text-2xl text-gray-900 mb-2">Danger zone</h2>
    <p class="text-sm text-gray-600 mb-6">This action is irreversible</p>
    <button type="button"
      onclick="openModal('deleteModal')"
      class="w-full px-6 py-3 bg-black text-white rounded-xl hover:opacity-80 transition">
      Delete my account
    </button>
  </div>
</div>

<!-- PROFILE MODAL -->
<div id="profileModal" class="modal-overlay hidden">
  <div class="modal-container">
    <div class="modal-content">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl text-gray-900">Edit profile</h2>
        <button type="button" onclick="closeModal('profileModal')" class="text-black">✕</button>
      </div>

      <%= form_for(resource, as: resource_name, url: registration_path(resource_name),
        html: { method: :put, class: "space-y-5" }) do |f| %>

        <%= f.text_field :name,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "Name" %>

        <%= f.password_field :current_password,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "Current password" %>

        <div class="flex gap-3">
          <button type="button"
            onclick="closeModal('profileModal')"
            class="flex-1 px-4 py-3 bg-gray-100 rounded-xl">
            Cancel
          </button>

          <%= f.submit "Save",
            class: "flex-1 px-4 py-3 bg-black text-white rounded-xl cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- EMAIL MODAL -->
<div id="emailModal" class="modal-overlay hidden">
  <div class="modal-container">
    <div class="modal-content">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl text-gray-900">Change email</h2>
        <button type="button" onclick="closeModal('emailModal')" class="text-black">✕</button>
      </div>

      <%= form_for(resource, as: resource_name, url: registration_path(resource_name),
        html: { method: :put, class: "space-y-5" }) do |f| %>

        <%= f.email_field :email,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "New email" %>

        <%= f.password_field :current_password,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "Current password" %>

        <div class="flex gap-3">
          <button type="button"
            onclick="closeModal('emailModal')"
            class="flex-1 px-4 py-3 bg-gray-100 rounded-xl">
            Cancel
          </button>

          <%= f.submit "Update",
            class: "flex-1 px-4 py-3 bg-black text-white rounded-xl cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- PASSWORD MODAL -->
<div id="passwordModal" class="modal-overlay hidden">
  <div class="modal-container">
    <div class="modal-content">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl text-gray-900">Change password</h2>
        <button type="button" onclick="closeModal('passwordModal')" class="text-black">✕</button>
      </div>

      <%= form_for(resource, as: resource_name, url: registration_path(resource_name),
        html: { method: :put, class: "space-y-5" }) do |f| %>

        <%= f.password_field :password,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "New password" %>

        <%= f.password_field :password_confirmation,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "Confirm password" %>

        <%= f.password_field :current_password,
          class: "w-full px-4 py-3 border rounded-xl",
          placeholder: "Current password" %>

        <div class="flex gap-3">
          <button type="button"
            onclick="closeModal('passwordModal')"
            class: "flex-1 px-4 py-3 bg-gray-100 rounded-xl">
            Cancel
          </button>

          <%= f.submit "Update",
            class: "flex-1 px-4 py-3 bg-black text-white rounded-xl cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div id="deleteModal" class="modal-overlay hidden">
  <div class="modal-container">
    <div class="modal-content">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl text-red-700">Delete account</h2>
        <button type="button" onclick="closeModal('deleteModal')" class="text-black">✕</button>
      </div>

      <p class="text-gray-700 mb-6">
        This action cannot be undone.
      </p>

      <div class="flex gap-3">
        <button type="button"
          onclick="closeModal('deleteModal')"
          class="flex-1 px-4 py-3 bg-gray-100 rounded-xl">
          Cancel
        </button>

        <%= button_to "Delete permanently",
          registration_path(resource_name),
          method: :delete,
          class: "flex-1 px-4 py-3 bg-black text-white rounded-xl" %>
      </div>
    </div>
  </div>
</div>

<!-- MODAL STYLES -->
<style>
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
}
.modal-overlay.hidden { display: none }
.modal-container { width: 100%; max-width: 32rem }
.modal-content {
  background: white;
  border-radius: 1.5rem;
  padding: 2rem;
}
</style>

<!-- MODAL JS -->
<script>
function openModal(id) {
  const m = document.getElementById(id)
  if (!m) return
  m.classList.remove('hidden')
  document.body.style.overflow = 'hidden'
}
function closeModal(id) {
  const m = document.getElementById(id)
  if (!m) return
  m.classList.add('hidden')
  document.body.style.overflow = ''
}
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay:not(.hidden)')
      .forEach(m => closeModal(m.id))
  }
})
document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => {
    if (e.target === o) closeModal(o.id)
  })
})
</script>
